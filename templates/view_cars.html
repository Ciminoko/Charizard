{% extends 'base.html' %}
{% block content %}
<h2>Available Cars</h2>
<div id="cars-list"></div>

<h3>Add a Car</h3>
<form id="add-car-form">
    <label for="make">Make:</label>
    <input type="text" id="make" name="make" required>
    <br>
    <label for="model">Model:</label>
    <input type="text" id="model" name="model" required>
    <br>
    <label for="year">Year:</label>
    <input type="number" id="year" name="year" required>
    <br>
    <button type="submit">Add Car</button>
</form>

<script>
    // Fetch and display cars
    fetch('/api/cars')
        .then(response => response.json())
        .then(cars => {
            const carsList = document.getElementById('cars-list');
            cars.forEach(car => {
                const carDiv = document.createElement('div');
                carDiv.innerHTML = `<p>${car.make} ${car.model} (${car.year})</p>`;
                carsList.appendChild(carDiv);
            });
        });

    // Add car
    document.getElementById('add-car-form').addEventListener('submit', event => {
        event.preventDefault();
        const token = localStorage.getItem('access_token'); // Store your token here

        const formData = new FormData(event.target);
        fetch('/api/cars', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                make: formData.get('make'),
                model: formData.get('model'),
                year: formData.get('year'),
            }),
        }).then(response => response.json())
          .then(data => {
              console.log('Car added:', data);
              location.reload(); // Reload the page to show the new car
          });
    });
</script>
{% endblock %}
